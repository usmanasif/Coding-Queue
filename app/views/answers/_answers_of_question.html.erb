<!--##################### END First Loop ###########################################-->


<% @answer.vote_calculate(@question).each do |x|%>

        <div class="q-post">
          <div class="q-top">
            <div class="counter-holder">
              <ul class="counter-nav">
                <li><span class="answer_votes_<%= x.id%>">Votes:<%= x.votes.sum(:status) %> </span></li>
              </ul>
              <strong class="by-date"> <span class="u-name"><a href="#"><%= x.user.email %></a> <%= x.user.rating %></span>
                <span>Asked<span class="ago-days"> <%= time_ago_in_words(x.created_at) %> ago</span></span>
              </strong>
            </div>
            <div class="middle-holder">
              <div class="rating-icon-holder">
                <ul class="a-q-flag">
                  <li><a href="javascript:void(0);" data-id="<%= x.id %>" data-type="Answer" class="flag">flag</a></li>
                  <li><a href="#" class="link-icon">link</a></li>
                </ul>
            
                <%# logger.debug current_user.votes.present? %>

                <% if current_user && current_user.id == @question.user_id  %>
                    <% if x.tick_status == 1 %>
                        <%= link_to  " Tick ", "javascript:void(0);", :class => "tick-colour" %>
                    <% else %>
                        <%= link_to  " Tick ", "javascript:void(0);", :class => "tick-simple", :data_id => x.id %>
                    <% end %>

                <% elsif x.tick_status == 1 %>
                    <%= link_to  " Tick ", "javascript:void(0);", :class => "tick-colour" %>
                <% end %>

                <div class="about-question" id="answers_of_Question">

                    <span class="ans_<%= x.id%>">
                    <% if(current_user && current_user.votes.where(votable_id: x.id , Votable_type: "Answer").present? && x.votes.present? ) %>
                        <input type="hidden" name="<%= x.id %>_A_user_id" id="<%= x.id %>_A_user_id" value="<%= x.user_id %>" >
                        <input type="hidden" name="last_voted_<%= x.id %>" id="last_voted_<%= x.id %>" value='<%= current_user.votes.where(votable_id: x.id , Votable_type: "Answer").last.status %>' />

                        <% if current_user.votes.where(votable_id: x.id , Votable_type: "Answer").last.status == 1 %>
                            <input type="hidden" name="answer_id" id="answer_id" value='<%= x.id %>' />
                              <%= link_to  "VOTE DOWN", 'javascript:void(0);', :id => "ans_vote_down_#{x.id}", :class => "unlike-down-answer" , :data => x.id %>

                        <% elsif current_user.votes.where(votable_id: x.id , Votable_type: "Answer").last.status == -1   %>

                            <%= link_to 'VOTE UP', 'javascript:void(0);', :class => "like-up-answer", :id => "ans_vote_up_#{x.id}", :data => x.id  %>
                              <input type="hidden" name="answer_id" id="answer_id" value='<%= x.id %>' />

                        <% end %>
                    <% else %>
                          <%= link_to 'VOTE UP', 'javascript:void(0);', :id => "ans_vote_up_#{x.id}", :class => "like-up-answer"  , :data => x.id%>
                            <input type="hidden" name="answer_id" id="answer_id" value='<%= x.id %>' />
                          <%= link_to  "VOTE DOWN", 'javascript:void(0);' ,:id => "ans_vote_down_#{x.id}", :class => "unlike-down-answer" , :data => x.id%>
                    <% end %>
                    </span>
                </div>
              </div>
              <div class="user-question">
                <span class="user-img"> <%= image_tag avatar_url(x.user) %></span>
                <span class="post-heading"><%= raw(x.answer) %></span>
                <!--<///////// -- Comment loop --answer-- --//////>-->
                <div class="comment-holder">
                  <div class="comment-copy-Answer<%= x.id%>">


                    <% @comments.each do |comment| %>
                        <%# logger.debug "COMENT ON ANSWER" * 12 %>
                        <%# logger.debug comment.inspect  %>
                        <%# logger.debug comment.commentable_id %>
                        <%# logger.debug ans.id %>
                        <%# logger.debug  comment.commentable_type   %>
                        <%# logger.debug  "comENDcom " * 3   %>

                        <% if comment.commentable_id == x.id && comment.commentable_type == "Answer"%>

                            <div class="inner-c">
                              <% if current_user.present? && current_user.id == comment.user_id %>
                                  <span><%= best_in_place comment, :description, :path => comment_path(answer_id: comment.commentable_id, id: comment.id) %> </span>
                              <% else %>
                                  <span><%=  comment.description %> </span>
                              <% end %>

                              <span class="by-post-user">
                                            <a href="#" class="us-name"> <%= comment.user.email %></a>
                                            <a href="#" class="by-date-user">Jan3 '10 at 23:56 <%= time_ago_in_words(comment.created_at) %></a> <img src="/assets/comment-edit.png">
                                        </span>
                            </div>

                        <% end %>
                    <% end %>


                  </div>

                  <div class="create-comment">
                    <%= form_for  @comment, :url =>  comments_path(answer_id: x.id), :html => { :id => "new_comment_#{x.id}"} do |f| %>
                        <% if @comment.errors.any? %>
                            <div id="errorExplanation">
                              <h2><%= pluralize(@comment.errors.count, "error") %> prohibited
                                this post from being saved:</h2>
                              <ul>
                                <% @comment.errors.full_messages.each do |msg| %>
                                    <li><%= msg %></li>
                                <% end %>
                              </ul>
                            </div>
                        <% end %>
                        <div class="txt-field4">
                          <%#= f.label :description %>
                          <!--<br />-->
                          <%= f.text_field :description, :class => "answer_comment" %>
                        </div>

                        <%= f.submit :class=>"comment-btn create-btn"%>

                    <% end %>

                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="q-btm">&nbsp;</div>
        </div>
  <%end %>